5장. 재미있는 Email

E-mail 통신은 지난 수십 년동안 정보 교환의 기본 모드가 됐다. email은 매일 여러 가지 이유로 작업한다. 하지만 파이썬으로 받은 편지함을 조작할 수 있다는 생각은 하지않을까?

5장에서는 다음 주제를 다룬다.

-email 메시지 전송
-email 암호화
-MIME 메시지로 email 메시지 꾸미기
-첨부파일과 email 메시지
-받은편지함 연결
-email 메시지 가져 오기 및 읽기
-email 메시지 표시
-받은편지함의 email 메시지 삭제
-email 응답을 통한 고객 지원 흐름 자동화

소개

안녕, 여러분! 좋은 하루를 희망한다. 5장에서는 email 및 파이썬을 사용한 email로 수행할 수 있는 수많은 작업을 다룬다. 우리는 또한 실제 비즈니스 유스 케이스의 도움을 받아 email로 비즈니스 프로세스를 자동화하는 방법을 이해할 것이다.

그래서 우리는 무엇을 기다리고 있을까? email의 역사와 기술 구현에 대해 조금씩 배우기 시작하자.

Page 140.

전자 메일은 실제로 소개할 필요가 없다. 물론 그들은 컴퓨터 사용자 간에 디지털 메시지를 교환하는 방법이다. 전자 메일은 정보 교환을 위해 인터넷을 통해 사용할 수 있는 컴퓨터 네트워크에서 작동한다. 인기있는 전자 메일 클라이언트에 로그인하여 전자 메일 서버에 저장된 메시지 작업을 시작할 수 있다. 가장 널리 사용되는 웹 클라이언트는 Gmail이다. 

전자 메일은 매우 흥미로운 역사를 가진다. 과거에는 전자 메일을 사용하려면 보낸 사람과 받는 사람이 통신에 성공하려면 온라인 상태여야했다. 그건 별로 의미가 없었어, 그렇지? 점차적으로 시간이 지남에 따라 전자 메일 서버가 지능화되고 점포 및 철학(store-and-forward philosophy)으로 작동했다. 오늘날 전자 메일 메시지는 서버에 비동기적으로 저장되므로 수신자는 나중에 편리하게 볼 수 있다. 따라서 전자 메일 서버는 메시지 수락, 전달 및 표시와 같은 기능을 제공할 수 있다.

전자 메일 메시지는 서식있는 텍스트 및 첨부파일의 MIME(Multipurpose Internet Mail Extensions)에 의해 나중에 확장된 ASCII 전용 문자로 시작됐다. 프로토콜 관점에서 전자 메일은 처음에는 FTP(File Transfer Protocol)를 사용하여 컴퓨터 간에 메시지를 전송하지만 인식할 수 있는 것처럼 SMTP(Simple Mail Transfer Protocol)는 전자 메일 작업에 가장 널리 사용되는 프로토콜이다.

<<중요표시시작>>
전자 메일 서버 설정은 이 책에서 다루지 않는다. 인터넷을 살펴보면 시작하는 데 도움이 되는 더 많은 리소스를 찾을 수 있다. 5장의 범위는 파이썬 프로그램을 사용하여 이메일로 할 수 있는 일을 알려주는 것이다. 구글은 구글 웹 클라이언트에 적용되는 예제를 사용하므로 코드 예제를 신속하게 시도해보고 파이썬을 사용하여 전자 메일 서버를 설정없이 전자 메일 작업을 자동화할 수있는 능력을 높이 평가할 수 있다. 
<<중요표시종료>>

5장에서는 파이썬을 사용하여 전자 메일을 사용하는 방법을 살펴볼 것이다. 밑에 나열된 여러 파이썬 모듈을 사용하여 전자 메일 메시지에 대한 다양한 작업도 수행한다.

<주소>

<<중요표시시작>>
파이썬을 사용하여 전자 메일 작업을 할 때 필요한 것은 메시지를 구성하는 데 도움이 되는 모듈, 전자 메일을 전송할 수 있는 모듈 및 메시지를 검색하고 업데이트하는 데 도움이 되는 모듈이다.
<<중요표시종료>>

Page 141.

2017.05.22

전자 메일 메시지 전송

전자 메일 클라이언트를 통해 달성하고자 하는 가장 중요한 일은 친구 혹은 동료의 전자 메일 주소로 메시지를 전송하는 것이다. 파이썬에서 이것을 어떻게 달성할 수 있는지 살펴보자.

준비하기

전자 메일 메시지를 전송하려면 파이썬 smtplib 모듈이 필요하다. 이름에서 알 수 있듯이 이 라이브러리는 SMTP 프로토콜을 사용하여 전자 메일 메시지를 전송한다. 다음 커맨드로 smtplib을 선호하는 pip 도구로 설치할 수 있다. 하지만 파이썬의 기본 설치는 이미 이 모듈을 가지고 있어야 한다.

<소스>

실행방법

1. 컴퓨터에서 좋아하는 편집기를 열고 다음 코드 조각을 추가한다. 이를 config.py라고 한다. 구성 파일에는 전자 메일 주소, 패스워드 및 전자 메일을 전송할 전자 메일 주소와 같은 로그인 세부 정보가 있다.

<소스>

2. 이제 이 환경 파일을 사용하여 전자 메일을 전송하는 코드를 작성해보자. 

<소스>

3. 앞의 코드를 basic_email.py로 저장하고 다음 커맨드를 사용하여 코드를 실행한다.

<소스>

Page 142.

4. 앞의 코드를 실행하면 SMTPAuthenticationError 예외가 표시되고 종료 코드(exit code) 1로 프로그램이 실패한다. 예외가 어떻게 발생하는지 확인한다.

<그림>

5. 좋아, 그게 나쁘지만 반대로, 좋다! 예외는 서버에 로그인해도 문제가 없었지만 Gmail에서 메시지를 보내지 못하게했다. 이제 Gmail에 로그인하면 안전성이 낮은 앱에서 로그인이 감지되었음을 알리는 이메일이 표시된다. 정말이니? 그래, 파이썬 프로그램에서 Gmail 계정에 액세스하려고 했기 때문이다. 구글 계정에 악의적인 활동이 있는경우 보안 위반 가능성을 제안하는 전자 메일을 구글로부터 수신받는 이유다. 구글의 전자 메일 메시지는 다음 스크린샷에서 확인할 수 있다.

<그림>

Page 143.

6. 그러나 분명히 이것은 구글 계정을 사용하려는 합법적인 시도였으므로 구글에 확인해보자. 구글의 전자 메일 메시지를 열고 ALLOW ACCESS을 클릭한다. Less secure apps 앱 페이지로 이동하여 다음 스크린샷과 같이 이 설정을 사용할 수 있다.

<그림>

7. 이제 구글 웹 클라이언트에서 로그 아웃한 다음 다시 로그인하여 계정에서 설정을 적용한다. 이 과정이 정상적으로 완료되면 Access for less secure apps is turned on 되었다는 이메일이 Google로부터 수신된다. 구글의 확인 이메일은 이 스크린샷과 유사하다.

<그림>

이제 파이썬 프로그램을 다시 실행하면 성공적으로 실행되어야하며 받은 편지함에 전자 메일이 전송된다.

<그림>

Page 144.

2017.05.23

8. 시원해! 메시지 내용은 코드 조각에 추가한 내용과 같다. 또한 from과 to 주소가 동일하기 때문에 전자 메일은 사용자가 보낸 것이지만 제목이 없으므로 훌륭하지 않다. 다음 레시피에서 이 문제에 대해 살펴볼 것이다.

작동원리

앞에서 설명한 것처럼 SMTP는 전자 메일 메시지를 전송하는 데 사용된다. 이 목적으로 파이썬 모듈인 smtplib을 사용한다.

앞의 코드 조각을 살펴보면 smtplib.SMTP() 생성자를 사용하여 Gmail의 SMTP 설정을 구성하고 이메일 서버에 액세스할 수 있다. Gmail의 SMTP 서버는 smtp.gmail.com 및 포트 587에서 실행된다.

서버 객체인 server가 있으면 우리는 server를 사용하여 사용자 이름과 비밀번호로 Gmail에 로그인한다. 앞의 코드에는 server.starttls()라는 또 다른 행이 있다. 5장의 뒷부분에서 다룬다.

테스트 메시지를 생성하여 변수 msg에 저장한 다음 sendmail 메소드('fromaddr', 'toddr', msg)를 사용하여 전송된다.

마지막으로 server.quit()를 사용하여 전자 메일 서버에 대한 연결을 닫는다.

더 알아보기

Gmail에 로그인하고 SMTP 프로토콜과 파이썬의 smptlib 라이브러리를 사용하여 기본 전자 메일을 보내는 방법을 살펴봤다. 이 레시피가 우리를 시작하게 만들었지만, 다음 레시피에서 더 자세히 설명할 것이다. 그것을 살펴보자.

전자 메일 암호화

전자 메일은 정보 유출이 쉽다. 대부분의 전자 메일은 현재 일반 텍스트 형식으로 전송된다. 전자 메일 암호화는 전자 메일의 내용을 암호화하거나 위장하여 의도한 수신자가 내용을 읽을 수 있게 한다. 전자 메일을 다룰 때는 항상 보안이 가장 중요하다는 것을 기억한다. 파이썬으로 전자 메일을 암호화하는 방법을 살펴보자.

Page 145.

준비하기

이전 레서피에서 기본 전자 메일을 전송했지만 starttls() 메소드는 무엇인가? 전자 메일 암호화는 어떻게 작동하나? 이 절에서는 이러한 질문에 대한 답을 얻을 것이다.

실행방법

1. 우선 가장 좋아하는 편집기를 열고 다음 코드 조각을 입력하자.

<소스>

2. 이제, 파이썬 코드를 실행하고 그것이 무엇을 출력하는지 살펴보자. 세 가지 부문으로 결과를 보여준다. 첫 번째는 전자 메일 서버에 ehlo() 메시지를 전송할 때다.

<그림>

Page 146.

3. 두 번째는 서버 객체에서 starttls() 메소드를 호출할 때다. 다음 스크린 샷을 확인한다.

<그림>

4. 세 번째는 ehlo()를 사용하여 전자 메일 서버에 다시 연결할 때다.

<그림>

Page 147.

작동원리

기본부터 시작하자. 전자 메일 암호화란 의도한 당사자가 아닌 다른 사람이 읽는 전자 메일 메시지를 보호하는 것을 의미한다. 전자 메일은 일반적으로 일반 텍스트로 전송되며 서드파티에서 스니핑할 수 있다. 이를 방지하기 위해 프로토콜 레이어에서 전자 메일을 암호화한다. 이것은 인증도 포함될 수 있다.

SMTP 서버는 일반적으로 SSL/TLS 프로토콜을 사용하여 포트 25에서 전자 메일을 전송한다. 그러나 STARTTLS(SMTP 상단 계층)와 메시지 제출을 위한 포트 587의 사용으로 인해 Gmail과 같은 전자 메일 클라이언트는 전자 메일을 보내기 위해 STARTTLS 및 포트 587을 사용한다. Gmail에는 인증이 구현된다. server.login(username, password)을 사용하여 Gmail 서버에 로그인했음을 기억한다.

STARTTLS를 서버와 클라이언트에서 사용하려면 클라이언트가 먼저 서버가 이 프로토콜을 지원하는지 알아야한다. server.ehlo()를 실행하면 프로그램이 SMTP 서버에 EHLO 메시지를 전송하여 통신을 설정한다. 첫 번째 스크린샷에서 볼 수 있듯이 서버는 메시지 및 허용된 확장명으로 응답한다.

이제 코드에서 서버가 server.has_extn('STARTTLS')을 사용하여 STARTTLS 확장자를 지원하는지 확인한다. 첫 번째 스크린샷에서 보았듯이 SMTP 서버는 STARTTLS 확장자로 응답했다. 이것은 gmail이 STARTTLS 프로토콜 레이어를 지원한다는 것을 확인한다.

이제 server.starttls()를 사용하여 서버와 통신한다. 서버는 Ready to start TLS라는 메시지를 전송해서 이에 응답한다. 이렇게하면 세션이 암호화된다. 세 번째 스크린샷을 보면 server.ehlo()를 보낼 때 TLS 세션을 통해 서버를 식별할 수 있다. 또한 서버가 인증 확장(authentication extension)을 구현할 것을 제안한다.

마지막으로 server.quit()을 사용하여 SMTP 세션을 종료하고 세 번째 스크린샷과 같이 서버가 연결을 닫으면 응답한다.

더 알아보기

그래, 매우 자세하게 설명했다. 그것을 이해하기 위해 잠시 시간을 가진다. 간단한 전자 메일 메시지를 보내는 것에서 일어나는 일은 실제로 흥미롭다. 그러나 너무 많이 걱정하지마. 재미있게 시작하고 더 많은 예제를 살펴보자.

Page 148.

MIME을 사용한 전자 메일 메시지 꾸미기

처음 몇 가지 레시피에서는 전자 메일 메시지를 오래된 간단한 평문 텍스트 형식으로 전송했다. MIME 인터넷 표준은 비 ASCII 문자, 다중 메시지 및 이미지로 메시지를 구성하는 데 도움이 된다. 또한 첨부 파일 및 기타 많은 작업에 도움이 된다. 이렇게하면 풍부한 전자 메일 메시지를 구성할 수 있다. 이 레시피에서 MIME 형식이 어떻게 사용되는지 살펴보자.

준비하기

이 레시피에서는 동일한 모듈인 smtplib을 사용하여 전자 메일 메시지를 전송한다. MIME 형식으로 더 나은 전자 메일 메시지를 생성하는 데 도움이 되는 또 다른 모듈인 email을 다룬다. email 모듈은 파이썬 설치와 함께 제공된다. 따라서 새로운 모듈 혹은 설치가 필요하지 않다. 이 절에서는 MIME 속성을 사용하여 보다나은 전자 메일을 전송하는 방법을 살펴본다.

실행방법

